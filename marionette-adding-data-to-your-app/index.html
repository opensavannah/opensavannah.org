<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Marionette: Adding data to your app</title>
  <meta name="description" content="We are a local brigade of Code for America committed to making government work better in Greater Savannah.">
  <link rel="icon" href="/images/favicon.ico">

  <!-- Bootstrap 3.3.6 core CSS (Bootswatch Paper theme) -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>
  <!-- <link href="css/bootstrap.css" rel="stylesheet"> -->

  <!-- Custom CSS -->
  <link href="/css/style.css" rel="stylesheet">

  <!-- Font Awesome 4.5.0 -->
  <link type="text/css" href="https://cvlassets.s3.amazonaws.com/fa-svg-with-js.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Analytics -->
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106536779-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106536779-1');
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W996VSP');</script>
<!-- End Google Tag Manager -->
<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/8cb53edd784a0b3afcd0e387d/8bca160c24bb6a0fef6e826fc.js");</script>
</head>


  <body><div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=486354278076833";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

  <header class="site-header">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><img src="https://crimson-dragonfruit.cloudvent.net/img/code_for_boston_logo.png" height="35" alt="Open Savannah" /></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="/about" class="dropdown-toggle" data-toggle="dropdown"> ABOUT <b class="caret"></b></a>
              <ul class="dropdown-menu">
              <li><a href="/who-we-are"><i class="fa fa-users"></i> Who We Are</a></li>
                <li><a href="/what-we-do"><i class="fa fa-wrench"></i> What We Do</a></li>
                     <li><a href="/our-manifesto"><i class="fa fa-users"></i> Vision and Operating Principles</a></li>
                     <li><a href="/our-manifesto"><i class="fa fa-users"></i> Theory of Change</a></li>
                <li><a href="/core-beliefs"><i class="fa fa-sticky-note"></i> Our Guiding Patterns </a></li>
                <li><a href="/diversity-statement"><i class="fa fa-universal-access"></i> Diversity and Inclusion</a></li>
                <li><a href="/civic-projects/"><i class="fa fa-cogs"></i> Our Projects</a></li>
                <li><a href="/in-the-news"><i class="fa fa-newspaper"></i> Press Coverage</a></li>
                <li><a href="/code-of-conduct"><i class="fa fa-code"></i> Code of Conduct</a></li>
              </ul>
            </li>
             <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">GET INVOLVED <b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="/getting-started"><i class="fa fa-arrow-right"></i> Quickstart Guide</a></li>
                <li><a href="http://www.meetup.com/opensavannah/" target="_blank"><i class="fa fa-calendar"></i> Show Up (Meetup)</a></li>
                <li><a href="https://github.com/opensavannah/projects" target="_blank"><i class="fa fa-cogs"></i> Start a Project (GitHub)</a></li>
                <li><a href="http://discourse.opensavannah.org" target="_blank"><i class="fa fa-comments"></i> Discuss/Discover Shared Knowledge (Discourse)</a></li>
                <li><a href="http://slack.opensavannah.org" target="_blank"><i class="fab fa-slack-hash"></i> Chat With Us (Slack)</a></li>
              </ul>
            </li>
          
                        <li><a href="http://data.opensavannah.org" target="_blank"><i class="fa fa-database"></i> OUR DATA</a></li>
            <li><a href="https://blog.opensavannah.org" target="_blank"><i class="fa fa-rss"></i> BLOG</a></li>
            <li><a href="/contact"><i class="fa fa-paper-plane"></i> CONTACT</a></li>
<li><a href="https://opensavannah.org/donate" target="_blank"><i class="fab fa-hand-holding-usd"></i> DONATE</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

  </header>
<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0075/4162.js" async="async"></script>


    <body>

      <div class="container">

        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <h2>Marionette: Adding data to your app</h2>
            <p>Jan 23, 2014 • Kaleb Clark</p>

<p>Now that we have an application stack generated by the generator, we can start adding views and controllers.</p>

<p>We will look at adding a simple data structure that will have a <a href="http://backbonejs.org/#Model">model</a>, <a href="Collection">collection</a>, <a href="https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.collectionview.md">collectionView</a>, <a href="https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.itemview.md">itemView</a> and a form to input data.</p>

<p>The model and collection are both part of the base Backbone framework. collectionView and ItemView are Marionette specific.</p>

<p><strong>Note</strong>: When we create these using yo, they are only placed in the file structure. They are <strong>not</strong> added to the application stack. We will have to do that manually.</p>

<p><strong>Creating the model &amp; collection:</strong><br />
A collection is a collection of models. Models are single row level elements, while collections are many rows of the model. If we think of it this way, it makes sense to create the model &amp; collection at the same time. Yo can do this for us:</p>

<pre class="brush: bash; title: ; notranslate" title="">$ yo marionette:collection users --model user --create-all
   create scripts/collections/users.js
   invoke   marionette:model
   create     scripts/models/user.js
</pre>

<p><strong>Note</strong>: Seems like good practice to name the collection the plural of the model. {collection: users, model: user}</p>

<p><strong>Creating the views:</strong><br />
Views can be tied directly to the collection and model. For a model view, marionette uses ItemView. Collections use CollectionView. ItemViews render each model, while collectionViews render the entire collection of models. In Marionette, by rendering the CollectionView, it automatically renders the ItemView models.</p>

<pre class="brush: bash; title: ; notranslate" title="">$ yo marionette:collectionview users-view --itemview user-view --create-all
   create scripts/views/collection/users-view.js
   invoke   marionette:itemview
   create     scripts/views/item/user-view.js
   invoke       marionette:tmpl
   create         templates/item/user-view_tmpl.hbs
</pre>

<p>Note that this has also created a template in templates/item/ called userView_tmpl.hbs for the ItemView user-view, but did <strong>not</strong> create a template for the CollectionView users-view. This is because the CollectionView renders the ItemViews from userView and does not need a template for itself.</p>

<p>Reference: <a href="https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.collectionview.md#collectionviews-emptyview">CollectionView:EmptyView</a>. Will render when there are no items in the view.</p>

<p><strong>Creating the form:</strong><br />
The form view will be a marionette ItemView. yo can do this for us as well.</p>

<pre class="brush: bash; title: ; notranslate" title="">$ yo marionette:itemview user-form --create-all
   create scripts/views/item/userForm.js
   invoke   marionette:tmpl
   create     templates/item/userForm_tmpl.hbs
</pre>

<p>The itemview created a template for us.</p>

<p><strong>Putting it all together:</strong><br />
Now comes the manual part of putting it all together. We must initialize the collection in the application and render it.</p>

<p>Since we created everything through yo, its pretty much all tied together for us.</p>

<p>scripts/application.js – We need to add the collection, users-view and form-view. In the “define” and main function.</p>

<pre class="brush: jscript; title: File: scripts/application.js; notranslate" title="File: scripts/application.js">define([
  'backbone',
  'communicator',
  'collections/users',             /* Collection users */
  'views/collection/users-view',   /* CollectionView users-view */
  'views/item/user-form'           /* ItemView user-form */
],

function( Backbone, Communicator, Users, UsersView, UserForm ) {
  ...
</pre>

<p>The define needs to refer to the actual script name (minus the .js), and function reference is arbitrary. Its one to one, define =&gt; function. ie: ‘collection/users’ =&gt; Users, ‘views/item/user-form’ =&gt; UserForm. These function definitions can now be called in the main function, and will load the referenced script.</p>

<p>Setup the regions in scripts/application.js</p>

<pre class="brush: jscript; title: ; notranslate" title="">App.addRegions({
  userForm: '#user-form',
  userList: '#user-list'
});
</pre>

<p>Of course, you will have to put the ‘#user-form’ and ‘#user-list’ in your index.html somewhere.</p>

<p>Setup the initializers in scripts/application.js</p>

<pre class="brush: jscript; title: ; notranslate" title="">App.addInitializer( function () {
    /* Call the users Collection */
    App.users = new Users();

    /* Call and bind user-form ItemView to region 'userForm' */
    App.userForm.show( new FormView({collection: App.users}));

    /* Call and bind users-view CollectionView to region 'userList' */
    App.userList.show( new UsersView({collection: App.users}));

    Communicator.mediator.trigger("APP:START");
  });
</pre>

<p>Line 3 calls the users Collection. This adds the users Collection to the application<br />
Line 6 calls the user-form ItemView. This binds the ItemView to the region ‘userForm’.<br />
Line 9 calls the users-view CollectionView. This binds the CollectionView to the region ‘userList’.</p>

<p><strong>Setting up events in the form:</strong><br />
Now we have to setup the events in the form. These are located in the ItemView for the form scripts/views/item/user-form.js.</p>

<p>Marionette makes this very easy for us. Instead of having to fetch values from form elements each time we want to use them, Marionette has an object for this called ‘ui’. We can add references to the form elements in the ui object.</p>

<pre class="brush: jscript; title: ; notranslate" title="">ui: {
  name: '#name',
  dob:  '#dob'
},
</pre>

<p>Now these are tied to the main object as this.ui.name, and this.ui.dob.</p>

<p>Firing the add user event from a button:<br />
Thanks, Marionette for making this easy! First we add the button selector to the events object.</p>

<pre class="brush: jscript; title: ; notranslate" title="">events: {
  'click button': 'addNewUser'
}
</pre>

<p>This ties the button click event to the ‘addNewUser’ function we will create next. Put the following code just after the ‘events’ object.</p>

<pre class="brush: jscript; title: ; notranslate" title="">addNewUser: function() {
  this.collection.add({
    name: this.ui.name.val(),
    dob:  this.ui.dob.val()
  });
  this.ui.name.val('');   /* Clears the form */
  this.ui.dob.val('');    /* Clears the form */
}
</pre>

<p>The add method on the collection accepts JSON formatted values. In this case, we are pulling the form values from the ‘ui’ object.</p>

<p><strong>Setting up the templates:</strong><br />
The templates/item/user-form_tmpl.hbs file needs to have <input /> elements with id’s from the ‘ui’ object, as well as a button for the addNewUser event.</p>

<pre class="brush: xml; title: ; notranslate" title="">&lt;input type="text" id="name" /&gt;&lt;br/&gt;
&lt;input type="text" id="dob" /&gt;&lt;/br&gt;
&lt;button&gt;Add New User&lt;/button&gt;
</pre>

<p>The templates/item/user-view_tmpl.hbs file will render individual user-view models. It can reference the model by attribute wrapped in . This is part of the handlebars plugin.</p>

<pre class="brush: xml; title: ; notranslate" title="">&lt;div&gt;
  &lt;span&gt;&lt;/span&gt;
  &lt;span&gt;&lt;/span&gt;
&lt;/div&gt;
</pre>

<p>Thats it! run it!</p>



          </div>
        </div>

      </div>

        <footer>

    <div class="container">
      <hr>
      <div class="row">
        <div class="col-sm-6">
          <p><i class="fa fa-code"></i> Open Savannah, a Code for America Brigade (501-C3)
            <br><i class="fa fa-building"></i> 2222 Bull St., Savannah, Ga. 31401
            <br><i class="fa fa-paper-plane"></i> yall@opensavannah.org
            <br><i class="fal fa-code-branch"></i> Fork this site on <a href="https://github.com/opensavannah/opensavannah.org">GitHub</a></p>
        </div>
        <div class="col-sm-6">
          <ul class="list-unstyled pull-right">
            <li><a href="https://www.facebook.com/opensavannah"><i class="fab fa-facebook" target="_blank"></i></a></li>
            <li><a href="https://twitter.com/open_savannah"><i class="fab fa-twitter" target="_blank"></i></a></li>
            <li><a href="https://github.com/opensavannah"><i class="fab fa-github" target="_blank"></i></a></li>
            <li><a href="http://www.meetup.com/opensavannah/"><i class="fab fa-meetup" target="_blank"></i></a></li>
            <li><a href="http://www.medium.com/open-savannah/"><i class="fab fa-medium" target="_blank"></i></a></li>
          </ul>
        </div>
      </div>
    </div>

  </footer>

</body>

<!-- Bootstrap core JavaScript
================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<!-- <script src="js/jquery-1.11.1.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<!-- <script src="js/bootstrap.js"></script> -->

<!-- MailChimp Ajax Magic
================================================== -->
<script src="/js/jquery.ajaxchimp.js"></script>
<script>
  $('#mc-form').ajaxChimp({
    url: 'https://opensavannah.us15.list-manage.com/subscribe/post?u=8cb53edd784a0b3afcd0e387d&amp;id=a8613b38de'
  });
</script>
<script src="https://graphjs.com/v1/graph.js"></script>
<script>
GraphJS.init("FE059CD3-0D7B-4CCE-A332-F6E44B707DE4", {
        host: "https://gj9cd30d7b4ccea332f6e44b707de4.herokuapp.com/",
        theme: "light",
        color: "#3c3c3c"
});
</script>


    </body>

</html>
