<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Webscraping with R</title>
  <meta name="description" content="We are a local brigade of Code for America committed to making government work better in Greater Savannah.">
  <link rel="icon" href="/images/favicon.ico">

  <!-- Bootstrap 3.3.6 core CSS (Bootswatch Paper theme) -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>
  <!-- <link href="css/bootstrap.css" rel="stylesheet"> -->

  <!-- Custom CSS -->
  <link href="/css/style.css" rel="stylesheet">

  <!-- Font Awesome 4.5.0 -->
  <link type="text/css" href="https://cvlassets.s3.amazonaws.com/fa-svg-with-js.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Analytics -->
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106536779-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-106536779-1');
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W996VSP');</script>
<!-- End Google Tag Manager -->
<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/8cb53edd784a0b3afcd0e387d/8bca160c24bb6a0fef6e826fc.js");</script>
</head>


  <body><div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=486354278076833";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

  <header class="site-header">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><img src="https://crimson-dragonfruit.cloudvent.net/img/code_for_boston_logo.png" height="35" alt="Open Savannah" /></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="/about" class="dropdown-toggle" data-toggle="dropdown"> ABOUT <b class="caret"></b></a>
              <ul class="dropdown-menu">
              <li><a href="/who-we-are"><i class="fa fa-users"></i> Who We Are</a></li>
                <li><a href="/what-we-do"><i class="fa fa-wrench"></i> What We Do</a></li>
                     <li><a href="/our-manifesto"><i class="fa fa-users"></i> Vision and Operating Principles</a></li>
                     <li><a href="/our-manifesto"><i class="fa fa-users"></i> Theory of Change</a></li>
                <li><a href="/core-beliefs"><i class="fa fa-sticky-note"></i> Our Guiding Patterns </a></li>
                <li><a href="/diversity-statement"><i class="fa fa-universal-access"></i> Diversity and Inclusion</a></li>
                <li><a href="/civic-projects/"><i class="fa fa-cogs"></i> Our Projects</a></li>
                <li><a href="/in-the-news"><i class="fa fa-newspaper"></i> Press Coverage</a></li>
                <li><a href="/code-of-conduct"><i class="fa fa-code"></i> Code of Conduct</a></li>
              </ul>
            </li>
             <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">GET INVOLVED <b class="caret"></b></a>
              <ul class="dropdown-menu">
                  <li><a href="/getting-started"><i class="fa fa-arrow-right"></i> Quickstart Guide</a></li>
                <li><a href="http://www.meetup.com/opensavannah/" target="_blank"><i class="fa fa-calendar"></i> Show Up (Meetup)</a></li>
                <li><a href="https://github.com/opensavannah/projects" target="_blank"><i class="fa fa-cogs"></i> Start a Project (GitHub)</a></li>
                <li><a href="http://discourse.opensavannah.org" target="_blank"><i class="fa fa-comments"></i> Discuss/Discover Shared Knowledge (Discourse)</a></li>
                <li><a href="http://slack.opensavannah.org" target="_blank"><i class="fab fa-slack-hash"></i> Chat With Us (Slack)</a></li>
              </ul>
            </li>
          
                        <li><a href="http://data.opensavannah.org" target="_blank"><i class="fa fa-database"></i> OUR DATA</a></li>
            <li><a href="https://blog.opensavannah.org" target="_blank"><i class="fa fa-rss"></i> BLOG</a></li>
            <li><a href="/contact"><i class="fa fa-paper-plane"></i> CONTACT</a></li>
<li><a href="https://opensavannah.org/donate" target="_blank"><i class="fab fa-hand-holding-usd"></i> DONATE</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

  </header>
<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0075/4162.js" async="async"></script>


    <body>

      <div class="container">

        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <h2>Webscraping with R</h2>
            <p>Jan 31, 2015 • Jonathan Boiser</p>

<p>At the last meetup, Adam Kalsey gave a great presentation on scraping data from the web, illustrating the ideas with his beer-loving Twitterbot <a href="http://twitter.com/sactaps">@sactaps</a>. In this tutorial, I will show you how to scrape data from the web in R using the <code class="highlighter-rouge">rvest</code> package <a href="http://github.com/hadley/rvest">Github link</a>.</p>

<p><em>(Warning: This tutorial involves browsing to websites advertising the sale of beer. If you are not of legal drinking age, please try this tutorial with other age-appropriate websites. Thanks!)</em></p>

<h3 id="installing-rvest-and-selectorgadget">Installing <code class="highlighter-rouge">rvest</code> and SelectorGadget</h3>

<p>If you haven’t used R before, go ahead and download the R runtime and the RStudio Integrated Development Environment. We won’t cover the basics of using RStudio, but there are plenty of resources for getting started. All of the code below can be entered directly in the console, or in the text editor (and then executed using Cmd/Ctrl-Enter).</p>

<p>Currently, <code class="highlighter-rouge">rvest</code> is not available on CRAN, the official repository of R packages. You will need to download the source code directly from the GitHub repository.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># if you do not have it already, install the devtools package
install.packages("devtools")
devtools::install_github("hadley/rvest")
library(rvest)
</code></pre></div></div>

<p>Another helpful tool you will want to install is the <a href="http://selectorgadget.com/">SelectorGadget</a> Chrome extension, which makes it a lot easier to get the CSS selectors for webpage elements (compared to using “Inspect Element” and looking at the source code).</p>

<h3 id="finding-the-right-css-selectors">Finding the right CSS selectors</h3>

<p>Although Adam’s talk focused on using the XPath and YQL query languages, in many cases we can locate useful data based on their CSS selectors, especially when the webpage uses semantic tag attributes.</p>

<p>Our first stop on our cyber pub crawl is to the Capitol Tap Room (<a href="http://capitolbeer.com/on-tap/">link</a>). Here’s a screenshot of the tap list:</p>

<p><img src="/images/screenshots/capitol_taproom.png" alt="" /></p>

<p>If you have SelectorGadget installed, click the magnifying glass to the right of the Address Bar, where your other Chrome extensions might be. With the extension activated, when you hover different elements on the webpage, they will be highlighted. Try clicking different things to see what happens. Make note of the gray bar on the bottom right.</p>

<p>Now, very carefully, hover your mouse around the bottom of the tap list until the entire box is highlighted:</p>

<p><img src="/images/screenshots/capitol_taplist_div.png" alt="" /></p>

<p>In the gray bar, you will see it read <code class="highlighter-rouge">#on-tap</code>. What this is telling us is that the highlighted object is an HTML element (probably a <code class="highlighter-rouge">div</code>) with <code class="highlighter-rouge">id="on-tap"</code>. Now, if we were to try scraping this, we would get all of the HTML for the <code class="highlighter-rouge">div</code>. Preferably, we would like to get the different beers separated out. So let’s see if we can narrow things down to the individual beer names.</p>

<p>Press the “Clear” button on the gray bottom to clear your selection. Now, try hovering over the beer names until it highlights the smallest box around the text:</p>

<p><img src="/images/screenshots/capitol_beername.png" alt="" /></p>

<p>I couldn’t capture it on the screenshot, but SelectorGadget is telling me that the beer names are <code class="highlighter-rouge">h3</code> elements (which also has a <code class="highlighter-rouge">.left</code> class). (This isn’t very semantic at all!) And simply selecting <code class="highlighter-rouge">h3</code>s won’t be precise enought: there are over 100 <code class="highlighter-rouge">h3</code> elements on this page, and not all of them are the beers on tap. But because we know these are encased in the <code class="highlighter-rouge">div#on-tap</code> element, we can manually target these. Clear the query in the gray box and enter: <code class="highlighter-rouge">div#on-tap h3</code>. Now all of the beer names in the “On Tap” section will be highlighted. As an exercise, trying writing a similar query that will grab the names of the bottles for sale (below the tap list).</p>

<h3 id="grabbing-the-data-in-r">Grabbing the data in R</h3>

<p>Now that we have some idea of what we should be querying off the webpage, let’s go into R. Enter these commands in the console:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>page &lt;- rvest::html("http://capitolbeer.com/on-tap/")
beers_html &lt;- rvest::html_nodes(x = page, css = "div#on-tap h3")
head(beers_html) # prints the html to the console
rvest::html_text(beers_html, trim = TRUE) # gets the text inside the tags and cleans up the whitespace characters
</code></pre></div></div>

<p>Here’s what you should see after the last command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Two Rivers Huckleberry Cider"                      "Evil Twin Freudian Slip Barleywine"
[3] "Bike Dog Mosaic Pale Ale"                          "Wildcard 2nd Anniversary BBA Porter"
[5] "Mraz Winter  IPA"                                  "Wildcard Liar’s Dice IPA"
[7] "Avery duganA Double IPA"                           "Warped Clear The Flag Rye Persimmon Ale"
[9] "Wildcard Reason For The Season Coffee Cream Stout" "Dogfish Head Beer Thousand Imperial Pilsner"
[11] "Wildcard Grade A Maple Brown"                      "Stillwater As Follows Golden Strong"
[13] "Wildcard 530 Hometown Ale"                         "Oskar Blues Icey PA Wheat Pale Ale"
[15] "Eel River Acai Berry Wheat"                        "St. Bernardus ABT 12 Quad"
[17] "Duchesse de Bourgogne Flemish Red"                 "Six Rivers Raspberry Lambic"
[19] "Woodfour Berliner Weisse"                          "Berryessa Rye Ryerish Dry Stout (Nitro)"
</code></pre></div></div>

<p>Very cool. The <code class="highlighter-rouge">rvest</code> functions also allow querying using XPath syntax, which was what Adam was covering. Scraping the data would then be the first step for doing interesting things with the data in R or some other programming language.</p>

<p>Give it a try with Capitol Tap Room’s site (extra credit for trying other beer websites) and drop by at our weekly meetings if you have cool webscraping ideas you want to work on!</p>


          </div>
        </div>

      </div>

        <footer>

    <div class="container">
      <hr>
      <div class="row">
        <div class="col-sm-6">
          <p><i class="fa fa-code"></i> Open Savannah, a Code for America Brigade (501-C3)
            <br><i class="fa fa-building"></i> 2222 Bull St., Savannah, Ga. 31401
            <br><i class="fa fa-paper-plane"></i> yall@opensavannah.org
            <br><i class="fal fa-code-branch"></i> Fork this site on <a href="https://github.com/opensavannah/opensavannah.org">GitHub</a></p>
        </div>
        <div class="col-sm-6">
          <ul class="list-unstyled pull-right">
            <li><a href="https://www.facebook.com/opensavannah"><i class="fab fa-facebook" target="_blank"></i></a></li>
            <li><a href="https://twitter.com/open_savannah"><i class="fab fa-twitter" target="_blank"></i></a></li>
            <li><a href="https://github.com/opensavannah"><i class="fab fa-github" target="_blank"></i></a></li>
            <li><a href="http://www.meetup.com/opensavannah/"><i class="fab fa-meetup" target="_blank"></i></a></li>
            <li><a href="http://www.medium.com/open-savannah/"><i class="fab fa-medium" target="_blank"></i></a></li>
          </ul>
        </div>
      </div>
    </div>

  </footer>

</body>

<!-- Bootstrap core JavaScript
================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<!-- <script src="js/jquery-1.11.1.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<!-- <script src="js/bootstrap.js"></script> -->

<!-- MailChimp Ajax Magic
================================================== -->
<script src="/js/jquery.ajaxchimp.js"></script>
<script>
  $('#mc-form').ajaxChimp({
    url: 'https://opensavannah.us15.list-manage.com/subscribe/post?u=8cb53edd784a0b3afcd0e387d&amp;id=a8613b38de'
  });
</script>
<script src="https://graphjs.com/v1/graph.js"></script>
<script>
GraphJS.init("FE059CD3-0D7B-4CCE-A332-F6E44B707DE4", {
        host: "https://gj9cd30d7b4ccea332f6e44b707de4.herokuapp.com/",
        theme: "light",
        color: "#3c3c3c"
});
</script>


    </body>

</html>
